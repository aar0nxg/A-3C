<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pixel Purple Rocket ‚Äî Love Run</title>
  <style>
    :root {
      --bg1:#12001f;
      --bg2:#2a0a4a;
      --fg:#e2c6ff;
      --accent:#b28bff;
      --danger:#ff6fb3;
      --success:#8dffca;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--fg);font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";}
    #wrap{position:fixed;inset:0;display:flex;flex-direction:column;}
    #hud{display:flex;gap:.75rem;align-items:center;justify-content:space-between;padding:.75rem 1rem;font-weight:700;letter-spacing:.02em;}
    #hud .pill{background:rgba(255,255,255,.08);padding:.35rem .6rem;border-radius:999px;backdrop-filter: blur(6px); box-shadow: 0 0 0 1px rgba(255,255,255,.05) inset;}
    #game{flex:1;position:relative;}
    canvas{position:absolute;inset:0;width:100%;height:100%;image-rendering: pixelated;image-rendering: crisp-edges;}
    #centerMsg{position:absolute;inset:0;display:none;place-items:center;pointer-events:none;text-align:center;padding:1rem;}
    #centerMsg .card{pointer-events:auto;max-width:680px;background:rgba(42,10,74,.72);border:1px solid rgba(255,255,255,.15);border-radius:18px;padding:18px 16px;box-shadow:0 20px 60px rgba(0,0,0,.45)}
    .btn{cursor:pointer;display:inline-flex;align-items:center;gap:.5rem;padding:.6rem .9rem;border-radius:14px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.08);color:var(--fg);font-weight:700}
    .btn:hover{background:rgba(255,255,255,.14)}
    .row{display:flex;gap:.5rem;flex-wrap:wrap;align-items:center;justify-content:center;margin-top:.5rem}
    small{opacity:.85}
    #touchHint{position:absolute;left:50%;bottom:18px;transform:translateX(-50%);opacity:.9;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.18);padding:.4rem .7rem;border-radius:999px;font-weight:700}
  </style>
</head>
<body>
  <div id="wrap">
    <div id="hud">
      <div class="pill">‚è±Ô∏è <span id="timer">03:00</span></div>
      <div class="pill">‚≠ê Score: <span id="score">0</span></div>
      <div class="pill">üöÄ Speed: <span id="speed">1.0x</span></div>
      <div class="pill">üïπÔ∏è Controls: <span id="controls">Space / Tap</span></div>
    </div>
    <div id="game">
      <canvas id="c"></canvas>
      <div id="centerMsg">
        <div class="card" id="centerCard"></div>
      </div>
      <div id="touchHint">TAP to thrust</div>
    </div>
  </div>

<script>
(() => {
  const view = document.getElementById('c');
  const ctx = view.getContext('2d');
  const W = 320, H = 180;
  const buffer = document.createElement('canvas');
  buffer.width = W; buffer.height = H;
  const g = buffer.getContext('2d');
  g.imageSmoothingEnabled = false; ctx.imageSmoothingEnabled = false;

  const DURATION = 180000;
  const GRAVITY = 0.28;
  const FLAP = -5.4;
  const BASE_SPEED = 0.55; // slower start
  const MAX_SPEED = 2.6;
  const ASTEROID_INTERVAL_MIN = 600;
  const ASTEROID_INTERVAL_MAX = 1700; // lighter early density
  const START_GRACE = 1500; // grace period before spawning
  const ROCKET_X = 56;

  let playing = false, finished = false, crashed = false, startedAt = 0, elapsed = 0, lastFrame = 0;
  let score = 0;
  let rocket = {x: ROCKET_X, y: H/2, vy: 0, w: 16, h: 10, invuln: 0};
  let obstacles = [];
  let stars = [];
  let nextAsteroidAt = 0;
  let girlfriend = null;

  const uiTimer = document.getElementById('timer');
  const uiScore = document.getElementById('score');
  const uiSpeed = document.getElementById('speed');
  const centerMsg = document.getElementById('centerMsg');
  const centerCard = document.getElementById('centerCard');
  const touchHint = document.getElementById('touchHint');

  window.addEventListener('keydown', e => { if (e.code === 'Space') { e.preventDefault(); flap(); }});
  window.addEventListener('touchstart', () => flap(), {passive:true});
  window.addEventListener('mousedown', () => flap());

  function flap(){ if(!playing && !finished){ start(); } if(playing){ rocket.vy = FLAP; }}

  function showCenter(html){ centerCard.innerHTML = html; centerMsg.style.display='grid'; }
  function hideCenter(){ centerMsg.style.display='none'; centerCard.innerHTML=''; }

  function start(){
    hideCenter();
    touchHint.style.display='none';
    playing = true; crashed = false; finished = false; score = 0; obstacles=[]; stars=[]; girlfriend=null; rocket.y=H/2; rocket.vy=0; rocket.invuln=800;
    startedAt = performance.now(); lastFrame = startedAt; elapsed = 0; nextAsteroidAt = 0;
    for(let i=0;i<80;i++) stars.push(newStar(Math.random()*W, Math.random()*H));
    requestAnimationFrame(loop);
  }

  function endWin(){ playing=false; finished=true; showWin(); }
  function endCrash(){ playing=false; crashed=true; showCrash(); }

  function speedAt(t){ const k = Math.min(1, t / DURATION); return BASE_SPEED + (MAX_SPEED - BASE_SPEED) * k; }
  function asteroidIntervalAt(t){ const k = Math.min(1, t / DURATION); return ASTEROID_INTERVAL_MAX + (ASTEROID_INTERVAL_MIN - ASTEROID_INTERVAL_MAX) * k; }
  function formatTime(ms){ const s = Math.ceil(Math.max(0, ms)/1000); const m = Math.floor(s/60).toString().padStart(2,'0'); const ss = (s%60).toString().padStart(2,'0'); return `${m}:${ss}`; }

  function newStar(x= W+8, y = Math.random()*H){ const layer = Math.random()<0.6? 0: (Math.random()<0.5?1:2); return {x,y,layer}; }
  function newAsteroid(t){ const r = 6 + Math.random()*10; const gapY = 12 + Math.random()*(H-24); const vy = (Math.random()*0.6-0.3); return {x: W+20, y: gapY, r, vy, scored:false}; }
  function spawnGirlfriend(){ girlfriend = {x: W+60, y: H/2-10, w: 18, h: 26, sway:0}; }

  function clear(){ const grd = g.createLinearGradient(0,0,0,H); grd.addColorStop(0, '#14002a'); grd.addColorStop(1, '#2a0a4a'); g.fillStyle = grd; g.fillRect(0,0,W,H); }
  function drawStars(dt, spd){ for(let s of stars){ const parallax = [0.25,0.5,1.0][s.layer]; s.x -= spd*parallax*dt; if(s.x<-4){ Object.assign(s,newStar()); } g.fillStyle=['#4b2a6b','#9d6cff','#e2c6ff'][s.layer]; g.fillRect(s.x|0,s.y|0,1,1);} }

  function drawRocket(){ const {x,y}=rocket; const px=(ix,iy,w,h,color)=>{ g.fillStyle=color; g.fillRect((x+ix)|0,(y+iy)|0,w,h); }; px(0,2,10,6,'#b28bff'); px(9,3,3,4,'#e2c6ff'); px(3,4,3,2,'#12001f'); px(0,1,2,2,'#8f5bff'); px(0,7,2,2,'#8f5bff'); const flame=Math.max(0,-rocket.vy*0.8); px(-2,4-(flame>0?1:0),2,2+((flame>2)?1:0),'#ff9ad2'); if(rocket.invuln>0&&((performance.now()%200)|0)<100){ g.globalCompositeOperation='lighter'; px(-1,2,1,6,'#ffffff'); g.globalCompositeOperation='source-over'; }}
  function drawAsteroid(a){ g.fillStyle='#6e49a3'; g.beginPath(); g.arc(a.x|0,a.y|0,a.r|0,0,Math.PI*2); g.fill(); g.fillStyle='#8a68c0'; g.fillRect((a.x-1)|0,(a.y-2)|0,2,2); }
  function drawGirlfriend(){ if(!girlfriend) return; const gx=girlfriend.x|0,gy=girlfriend.y|0; girlfriend.sway+=0.05; const sway=Math.sin(girlfriend.sway)*1.2; g.fillStyle='#2b0f46'; g.fillRect(gx+4,gy+1,10,8); g.fillStyle='#ffd1ea'; g.fillRect(gx+6,gy+4,6,6); g.fillStyle='#2b0f46'; g.fillRect(gx+7,gy+6,1,1); g.fillRect(gx+10,gy+6,1,1); g.fillStyle='#b28bff'; g.fillRect(gx+5,gy+11,8,10); g.fillStyle='#ffd1ea'; g.fillRect(gx+7,gy+21,2,4); g.fillRect(gx+9,gy+21,2,4); g.fillStyle='#ff6fb3'; g.fillRect(gx+1,gy+2+(sway|0),1,1); g.fillRect(gx+2,gy+1+(sway|0),1,1); g.fillRect(gx+2,gy+2+(sway|0),1,1); }
  function drawHUDOverlay(timeLeft){ if(timeLeft<7000){ const k=1-timeLeft/7000; g.fillStyle=`rgba(255,170,255,${0.08+0.25*k})`; g.fillRect(0,H-24,W,24);} }
  function aabb(x,y,w,h,x2,y2,w2,h2){return x<x2+w2&&x+w>x2&&y<y2+h2&&y+h>y2;}
  function rocketBox(){return {x:rocket.x,y:rocket.y,w:rocket.w,h:rocket.h};}

  function showIntro(){ const html=`<h2>üíú Pixel Purple Rocket ‚Äî Love Run</h2><p>Fly for <b>3 minutes</b>, dodge asteroids, and reach your girlfriend. <b>Space</b> or <b>Tap</b> to thrust.</p><div class='row'><button class='btn' id='btnStart'>Start</button></div>`; showCenter(html); document.getElementById('btnStart').onclick=()=>start(); }
  function showCrash(){ const html=`<h2>üí• Oops! You crashed</h2><p>Score: <b>${score}</b></p><div class='row'><button class='btn' id='btnRetry'>Try Again</button></div>`; showCenter(html); document.getElementById('btnRetry').onclick=()=>start(); }
  function showWin(){ const html=`<h2>üíû You made it!</h2><p>You reach her safely! Score: <b>${score}</b></p><div class='row'><button class='btn' id='btnReplay'>Replay</button></div>`; showCenter(html); document.getElementById('btnReplay').onclick=()=>start(); }

  function loop(now){ if(!playing) return; const dt=Math.min(40,now-lastFrame); lastFrame=now; elapsed=now-startedAt; const timeLeft=Math.max(0,DURATION-elapsed); const spd=speedAt(elapsed); rocket.vy+=GRAVITY; rocket.y+=rocket.vy; if(rocket.y<2){rocket.y=2;rocket.vy=0;} if(rocket.y>H-rocket.h-2){rocket.y=H-rocket.h-2;rocket.vy=0;} if(rocket.invuln>0) rocket.invuln-=dt; if(timeLeft>4500&&elapsed>START_GRACE){ if(now>nextAsteroidAt){ obstacles.push(newAsteroid(now)); const interval=asteroidIntervalAt(elapsed); nextAsteroidAt=now+interval*(0.7+Math.random()*0.6); } } else { if(!girlfriend) spawnGirlfriend(); } for(let i=obstacles.length-1;i>=0;i--){ const a=obstacles[i]; a.x-=spd*dt; a.y+=a.vy; if(a.x<-40) obstacles.splice(i,1); if(!a.scored&&a.x+a.r<rocket.x){score++;a.scored=true;} } drawFrame(dt,spd,timeLeft); if(rocket.invuln<=0&&!girlfriend){ const rb=rocketBox(); for(const a of obstacles){ if(aabb(rb.x,rb.y,rb.w,rb.h,a.x-a.r,a.y-a.r,a.r*2,a.r*2)){ endCrash(); ui(); return; } } } if(girlfriend){ girlfriend.x-=spd*dt*0.85; if(girlfriend.x<rocket.x+6){ endWin(); ui(); drawEndingEmbrace(); return; } } ui(timeLeft,spd); requestAnimationFrame(loop); }

  function drawEndingEmbrace(){ g.fillStyle='rgba(20,0,42,0.5)'; g.fillRect(0,0,W,H); for(let i=0;i<16;i++){ const x=(Math.random()*W)|0,y=(Math.random()*H)|0; g.fillStyle='#ff8ec6'; g.fillRect(x,y,1,1); g.fillRect(x+1,y,1,1); g.fillRect(x,y+1,1,1);} blit(); }
  function drawFrame(dt,spd,timeLeft){ clear(); drawStars(dt,spd); for(const a of obstacles){ drawAsteroid(a);} if(girlfriend) drawGirlfriend(); drawRocket(); drawHUDOverlay(timeLeft); blit(); }
  function blit(){ const vw=view.clientWidth,vh=view.clientHeight; const scale=Math.min(vw/W,vh/H); const dw=(W*scale)|0,dh=(H*scale)|0; const dx=((vw-dw)/2)|0,dy=((vh-dh)/2)|0; const dpr=window.devicePixelRatio||1; if(view.width!==vw*dpr||view.height!==vh*dpr){view.width=vw*dpr;view.height=vh*dpr;ctx.imageSmoothingEnabled=false;} ctx.clearRect(0,0,view.width,view.height); ctx.save(); ctx.imageSmoothingEnabled=false; ctx.drawImage(buffer,0,0,W,H,dx*dpr,dy*dpr,dw*dpr,dh*dpr); ctx.restore(); }
  function ui(timeLeft=Math.max(0,DURATION-(performance.now()-startedAt)),spd=speedAt(elapsed)){ uiScore.textContent=score; uiSpeed.textContent=( (spd/BASE_SPEED).toFixed(1)+'x'); uiTimer.textContent=formatTime(timeLeft); }

  showIntro();
  const hideHint=()=>{touchHint.style.display='none';window.removeEventListener('touchstart',hideHint);window.removeEventListener('mousedown',hideHint);}; window.addEventListener('touchstart',hideHint,{passive:true}); window.addEventListener('mousedown',hideHint);
})();
</script>
</body>
</html>
